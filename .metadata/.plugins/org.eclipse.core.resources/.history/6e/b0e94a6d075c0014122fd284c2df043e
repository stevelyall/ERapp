package ca.stevenlyall.ersurvey;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.AlertDialog.Builder;
import android.content.DialogInterface;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.RatingBar;
import android.widget.RatingBar.OnRatingBarChangeListener;
import android.widget.TextView;

public class SurveyActivity extends Activity {

	//TODO load these from a file
	
	Survey survey = new Survey();
	int questionNum = 0;
	boolean answered = false;
	
	
	// UI elements
	RatingBar rating; 
	Button nextButton, backButton;
	TextView questionTextView;

	
	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.activity_survey);
	    
	    rating = (RatingBar) findViewById(R.id.rating);
	    rating.setOnRatingBarChangeListener(new OnRatingBarChangeListener(){
			@Override
			public void onRatingChanged(RatingBar ratingBar, float rating,
					boolean fromUser) {
				answered = true;
				
			}
	    	
	    });
	    nextButton = (Button) findViewById(R.id.nextButton);
	    nextButton.setOnClickListener(new OnClickListener(){
	    //next button click
			@Override
			public void onClick(View v) {
				
				
			}
	    	
	    });
	    backButton = (Button) findViewById(R.id.backButton);
	    questionTextView = (TextView) findViewById(R.id.questionTextView);
	    
	    
	    askMA();
	}
	
	private void askMA() {
			if (questionNum>5) {
				Log.w("suvey", "all questions have been asked, questionNum=" + questionNum);
				return;
			}
			else {
				questionTextView.setText(survey.getMAQuestion(questionNum));
				nextButton.setOnClickListener(new OnClickListener() {
				
					@Override
					public void onClick(View v) {
						if (!answered) {
							AlertDialog.Builder needSelect = new AlertDialog.Builder(getApplicationContext());
							needSelect.setTitle("Please make selection");
							needSelect.setMessage("Please click a selection to indicate you have answered the quetsion");
							needSelect.setNeutralButton("Okay", new DialogInterface.OnClickListener() {
								
								@Override
								public void onClick(DialogInterface dialog, int which) {
									dialog.dismiss();
									
								}
							});
							
							AlertDialog dialog = needSelect.create();
							dialog.show();
						}
						
						survey.setMAResponse(questionNum, rating.getRating());
						Log.i("survey", survey.getMACode(questionNum) + " response collected: " + survey.getMAResponse(questionNum));
						questionNum++;
						rating.setNumStars(0);
						answered = false;
						askMA();
					}
				
				} );	
				
			}
	}
}
