package ca.stevenlyall.ersurvey;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.AlertDialog.Builder;
import android.content.DialogInterface;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.RatingBar;
import android.widget.RatingBar.OnRatingBarChangeListener;
import android.widget.TextView;
import android.widget.Toast;

public class SurveyActivity extends Activity {

	//TODO load these from a file
	
	Survey survey = new Survey();
	int questionNum = 0;
	boolean answered;
	
	
	// UI elements
	RatingBar rating; 
	Button nextButton, backButton;
	TextView questionTextView;

	
	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.activity_survey);
	    
	    rating = (RatingBar) findViewById(R.id.rating);
	    rating.setClickable(true);
	    nextButton = (Button) findViewById(R.id.nextButton);
	    backButton = (Button) findViewById(R.id.backButton);
	    questionTextView = (TextView) findViewById(R.id.questionTextView);
	    
	    
	    askMA();
	}
	
	private void askMA() {
			answered = false;
			Log.i("answered", "false");
			if (questionNum>5) {
				Log.w("survey", "all questions have been asked, questionNum=" + questionNum);
				return;
			}
			else {
				questionTextView.setText(survey.getMAQuestion(questionNum));
			   
				rating.setOnClickListener(new OnClickListener(){
					@Override
					public void onClick(View v) {
						answered = true;
						Log.i("answered","true");
						
					}
			    	
			    });
				nextButton.setOnClickListener(new OnClickListener() {
				
					@Override
					public void onClick(View v) {
						if (!answered) {
							Toast.makeText(getBaseContext(),"Please select an answer", Toast.LENGTH_SHORT).show();
							return;
						}
						
						survey.setMAResponse(questionNum, rating.getRating());
						Log.i("survey", survey.getMACode(questionNum) + " response collected: " + survey.getMAResponse(questionNum));
						questionNum++;
						rating.setNumStars(0);
						askMA();
					}
				
				} );	
				
			}
	}
}
